<!-- see https://github.com/asciidoctor/asciidoctor/issues/699#issuecomment-321066006 -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.11.1/tocbot.min.js"></script>
<script>
  /* Tocbot dynamic TOC, works with tocbot 3.0.2 */
  var oldtoc = document.getElementById('toctitle').nextElementSibling;
  var newtoc = document.createElement('div');
  newtoc.setAttribute('id', 'tocbot');
  newtoc.setAttribute('class', 'js-toc');
  oldtoc.parentNode.replaceChild(newtoc, oldtoc);
  tocbot.init({ contentSelector: '#content',
                headingSelector: 'h1, h2, h3, h4',
                smoothScroll: false });
  var handleTocOnResize = function() {
    var width = window.innerWidth
        || document.documentElement.clientWidth
        || document.body.clientWidth;
    if (width < 768) {
      tocbot.refresh({ contentSelector: '#content',
                       headingSelector: 'h1, h2, h3, h4',
                       //collapseDepth: 6,
                       //activeLinkClass: 'ignoreactive',
                       //throttleTimeout: 1000,
                       smoothScroll: false });
    }
    else {
      tocbot.refresh({ contentSelector: '#content',
                       headingSelector: 'h1, h2, h3, h4',
                       smoothScroll: false });
    }
  };
  window.addEventListener('resize', handleTocOnResize);
  handleTocOnResize();

  // responsive menu toggle
  var $toggle_button = document.createElement('button');
  var $body = document.querySelector('body');
  var menu_toggle_handler = function(e) {
    $body.classList.toggle('shownav');
  };
  $toggle_button.classList.add('toggle-button');
  $toggle_button.setAttribute('type', 'button');
  $toggle_button.innerHTML = "Menu";
  $toggle_button.addEventListener('click', menu_toggle_handler);
  $body.appendChild($toggle_button);
  var register_menu_toggle = function() {
    var $menu_links = document.querySelectorAll('a.toc-link');
    $menu_links.forEach(function($menu_link) {
      $menu_link.addEventListener('click', menu_toggle_handler);
    });
  };
  window.addEventListener('resize', register_menu_toggle);
  register_menu_toggle();

</script>
